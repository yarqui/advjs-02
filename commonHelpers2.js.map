{"version":3,"file":"commonHelpers2.js","sources":["../src/js/02-timer.js"],"sourcesContent":["import flatpickr from 'flatpickr';\nimport 'flatpickr/dist/flatpickr.min.css';\nimport {\n  ATTRIBUTES,\n  ATTRIBUTE_METHODS,\n  handleAttributeMethods,\n} from './common';\n\nconst refs = {\n  timePicker: document.querySelector('input#datetime-picker'),\n  startBtn: document.querySelector('button[data-start]'),\n  days: document.querySelector('.value[data-days]'),\n  hours: document.querySelector('.value[data-hours]'),\n  minutes: document.querySelector('.value[data-minutes]'),\n  seconds: document.querySelector('.value[data-seconds]'),\n};\n\nlet selectedDateAndTime;\nlet currentDateAndTime;\nlet activeIntervalId;\n\nconst convertMs = ms => {\n  // Number of milliseconds per unit of time\n  const second = 1000;\n  const minute = second * 60;\n  const hour = minute * 60;\n  const day = hour * 24;\n\n  // Remaining days\n  const days = Math.floor(ms / day);\n  // Remaining hours\n  const hours = Math.floor((ms % day) / hour);\n  // Remaining minutes\n  const minutes = Math.floor(((ms % day) % hour) / minute);\n  // Remaining seconds\n  const seconds = Math.floor((((ms % day) % hour) % minute) / second);\n\n  return { days, hours, minutes, seconds };\n};\n\nconst addLeadingZero = timeProps =>\n  Object.fromEntries(\n    Object.entries(timeProps).map(([key, value]) => [\n      key,\n      value.toString().padStart(2, '0'),\n    ])\n  );\n\nconst handlePickResult = () => {\n  const isReady = currentDateAndTime < selectedDateAndTime;\n\n  if (!isReady) {\n    alert('Please choose a date in the future');\n    selectedDateAndTime = currentDateAndTime;\n  }\n\n  handleAttributeMethods(\n    ATTRIBUTES.disabled,\n    isReady ? ATTRIBUTE_METHODS.remove : ATTRIBUTE_METHODS.set,\n    refs.startBtn\n  );\n};\n\nconst startTimer = () => {\n  currentDateAndTime = new Date().getTime();\n  handleAttributeMethods(ATTRIBUTES.disabled, ATTRIBUTE_METHODS.set, [\n    refs.startBtn,\n    refs.timePicker,\n  ]);\n  updateTimer();\n\n  activeIntervalId = setInterval(() => {\n    if (selectedDateAndTime - currentDateAndTime < 1000) {\n      clearInterval(activeIntervalId);\n      handleAttributeMethods(\n        ATTRIBUTES.disabled,\n        ATTRIBUTE_METHODS.remove,\n        refs.timePicker\n      );\n      return;\n    }\n\n    currentDateAndTime += 1000;\n    updateTimer();\n  }, 1000);\n};\n\nconst updateTimer = () => {\n  const timeDifference = selectedDateAndTime - currentDateAndTime;\n  const convertedMs = convertMs(timeDifference);\n  const { days, hours, minutes, seconds } = addLeadingZero(convertedMs);\n\n  refs.days.textContent = days;\n  refs.hours.textContent = hours;\n  refs.minutes.textContent = minutes;\n  refs.seconds.textContent = seconds;\n};\n\nconst pickDate = selectedDates => {\n  if (selectedDates) {\n    selectedDateAndTime = selectedDates[0].getTime();\n    currentDateAndTime = new Date().getTime();\n\n    handlePickResult();\n  }\n};\n\nconst flatpickrOptions = {\n  enableTime: true,\n  time_24hr: true,\n  defaultDate: new Date(),\n  minuteIncrement: 1,\n  onClose: pickDate,\n  //   disable: [{ from: new Date(0), to: new Date().getTime() }], // Block all dates before current\n};\n\nflatpickr(refs.timePicker, flatpickrOptions);\n\nhandleAttributeMethods(\n  ATTRIBUTES.disabled,\n  ATTRIBUTE_METHODS.set,\n  refs.startBtn\n);\n\nrefs.startBtn.addEventListener('click', startTimer);\n"],"names":["refs","selectedDateAndTime","currentDateAndTime","activeIntervalId","convertMs","ms","days","hours","minutes","seconds","addLeadingZero","timeProps","key","value","handlePickResult","isReady","handleAttributeMethods","ATTRIBUTES","ATTRIBUTE_METHODS","startTimer","updateTimer","timeDifference","convertedMs","pickDate","selectedDates","flatpickrOptions","flatpickr"],"mappings":"sMAQA,MAAMA,EAAO,CACX,WAAY,SAAS,cAAc,uBAAuB,EAC1D,SAAU,SAAS,cAAc,oBAAoB,EACrD,KAAM,SAAS,cAAc,mBAAmB,EAChD,MAAO,SAAS,cAAc,oBAAoB,EAClD,QAAS,SAAS,cAAc,sBAAsB,EACtD,QAAS,SAAS,cAAc,sBAAsB,CACxD,EAEA,IAAIC,EACAC,EACAC,EAEJ,MAAMC,EAAYC,GAAM,CAQtB,MAAMC,EAAO,KAAK,MAAMD,EAAK,KAAG,EAE1BE,EAAQ,KAAK,MAAOF,EAAK,MAAO,IAAI,EAEpCG,EAAU,KAAK,MAAQH,EAAK,MAAO,KAAQ,GAAM,EAEjDI,EAAU,KAAK,MAASJ,EAAK,MAAO,KAAQ,IAAU,GAAM,EAElE,MAAO,CAAE,KAAAC,EAAM,MAAAC,EAAO,QAAAC,EAAS,QAAAC,CAAO,CACxC,EAEMC,EAAiBC,GACrB,OAAO,YACL,OAAO,QAAQA,CAAS,EAAE,IAAI,CAAC,CAACC,EAAKC,CAAK,IAAM,CAC9CD,EACAC,EAAM,SAAU,EAAC,SAAS,EAAG,GAAG,CACtC,CAAK,CACL,EAEMC,EAAmB,IAAM,CAC7B,MAAMC,EAAUb,EAAqBD,EAEhCc,IACH,MAAM,oCAAoC,EAC1Cd,EAAsBC,GAGxBc,EACEC,EAAW,SACXF,EAAUG,EAAkB,OAASA,EAAkB,IACvDlB,EAAK,QACT,CACA,EAEMmB,EAAa,IAAM,CACvBjB,EAAqB,IAAI,OAAO,UAChCc,EAAuBC,EAAW,SAAUC,EAAkB,IAAK,CACjElB,EAAK,SACLA,EAAK,UACT,CAAG,EACDoB,IAEAjB,EAAmB,YAAY,IAAM,CACnC,GAAIF,EAAsBC,EAAqB,IAAM,CACnD,cAAcC,CAAgB,EAC9Ba,EACEC,EAAW,SACXC,EAAkB,OAClBlB,EAAK,UACb,EACM,MACD,CAEDE,GAAsB,IACtBkB,GACD,EAAE,GAAI,CACT,EAEMA,EAAc,IAAM,CACxB,MAAMC,EAAiBpB,EAAsBC,EACvCoB,EAAclB,EAAUiB,CAAc,EACtC,CAAE,KAAAf,EAAM,MAAAC,EAAO,QAAAC,EAAS,QAAAC,GAAYC,EAAeY,CAAW,EAEpEtB,EAAK,KAAK,YAAcM,EACxBN,EAAK,MAAM,YAAcO,EACzBP,EAAK,QAAQ,YAAcQ,EAC3BR,EAAK,QAAQ,YAAcS,CAC7B,EAEMc,EAAWC,GAAiB,CAC5BA,IACFvB,EAAsBuB,EAAc,GAAG,QAAO,EAC9CtB,EAAqB,IAAI,OAAO,UAEhCY,IAEJ,EAEMW,EAAmB,CACvB,WAAY,GACZ,UAAW,GACX,YAAa,IAAI,KACjB,gBAAiB,EACjB,QAASF,CAEX,EAEAG,EAAU1B,EAAK,WAAYyB,CAAgB,EAE3CT,EACEC,EAAW,SACXC,EAAkB,IAClBlB,EAAK,QACP,EAEAA,EAAK,SAAS,iBAAiB,QAASmB,CAAU"}